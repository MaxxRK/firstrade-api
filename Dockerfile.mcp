FROM python:3.12-slim

WORKDIR /app

# Install dependencies
COPY setup.py README.md ./
COPY firstrade/ ./firstrade/

RUN pip install --no-cache-dir . && \
    pip install --no-cache-dir mcp starlette uvicorn[standard]

# Copy MCP server
COPY mcp_server.py ./

# Create directories for config and data
RUN mkdir -p /config /data

# Set environment variable for config path
ENV FIRSTRADE_CONFIG=/config/config.json

# Expose port for SSE mode
EXPOSE 8080

# Default to SSE mode for Docker (can be overridden)
# Use --transport=stdio for stdio mode
CMD ["python", "mcp_server.py", "--transport", "sse"]
